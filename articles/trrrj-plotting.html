<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plotting trajectories • trrrj</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Plotting trajectories">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">trrrj</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/osn-access.html">How to Access OpenSky Network Data</a>
    </li>
    <li>
      <a href="../articles/trrrj-plotting.html">Plotting trajectories</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/euctrl-pru/trrrj">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Plotting trajectories</h1>
                        <h4 class="author">Enrico Spinielli</h4>
            
            <h4 class="date">2019-08-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/euctrl-pru/trrrj/blob/master/vignettes/trrrj-plotting.Rmd"><code>vignettes/trrrj-plotting.Rmd</code></a></small>
      <div class="hidden name"><code>trrrj-plotting.Rmd</code></div>

    </div>

    
    
<p>It is sometimes usefult to visually inspect flight trajectories. This vignette provides some examples and code snippets that show how to plot trajectories from Flight Radar 24 feed. In fact the snippets here can be used with any dataframe of position reports containing at least <code>timestamp</code>, <code>longitude</code>, <code>latitude</code> and <code>altitude</code> fields.</p>
<div id="plotting" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting" class="anchor"></a>Plotting</h2>
<p>In order to get some sample trajectory data, you can use the <code>trrrj</code> package datasets:</p>
<ul>
<li>
<code>flts</code>: 41 flights from FR24 for 2017-02-05 and 2017-02-05, check the documentation via <code><a href="../reference/flts.html">?flts</a></code>
</li>
<li>
<code>poss</code>: ADS-B positions reports for <code>flts</code>, check the documentation via <code><a href="../reference/poss.html">?poss</a></code>
</li>
<li>
<code>cprs</code>: CPR’s matching <code>flts</code>, check the documentation via <code><a href="../reference/cprs.html">?cprs</a></code>
</li>
</ul>
<p>We now plot the ADS-B positions just for one flight, flight <code>RYR19QK</code> from Comiso to Malpensa:</p>
<table class="table">
<thead><tr class="header">
<th align="left">date</th>
<th align="left">flight</th>
<th align="left">callsign</th>
<th align="left">equip</th>
<th align="right">fr24_id</th>
<th align="right">nm_id</th>
<th align="left">adep_icao</th>
<th align="left">adep_iata</th>
<th align="left">ades_icao</th>
<th align="left">ades_iata</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">2017-02-06</td>
<td align="left">FR8730</td>
<td align="left">RYR19QK</td>
<td align="left">B738</td>
<td align="right">207752905</td>
<td align="right">884714</td>
<td align="left">LIMC</td>
<td align="left">MXP</td>
<td align="left">LICB</td>
<td align="left">CIY</td>
</tr></tbody>
</table>
<p>We can now plot the ADS-B trajectory:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">europe &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dt">left =</span> <span class="dv">5</span>, <span class="dt">bottom =</span> <span class="dv">35</span>, <span class="dt">right =</span> <span class="dv">30</span>, <span class="dt">top =</span> <span class="dv">52</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"># let's just focus on 1 flight</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">trj_adsb &lt;-<span class="st"> </span>poss <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(flight_id <span class="op">==</span><span class="st"> </span><span class="dv">207752905</span>)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">trrrj<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/trrrj/topics/plot_flight_horizontal">plot_flight_horizontal</a></span>(trj_adsb, <span class="dt">bbox =</span> europe)</a></code></pre></div>
<div class="figure">
<img src="trrrj-plotting_files/figure-html/trj-adsb-ggmap-1.png" alt="2D plot via ggmap" width="672"><p class="caption">
2D plot via ggmap
</p>
</div>
<p>and the one from the CPRs:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">trj_cpr &lt;-<span class="st"> </span>cprs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(callsign <span class="op">==</span><span class="st"> "RYR19QK"</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">trj_cpr <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="st">  </span>trrrj<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/trrrj/topics/plot_cpr_horizontal">plot_cpr_horizontal</a></span>(europe)</a></code></pre></div>
<div class="figure">
<img src="trrrj-plotting_files/figure-html/trj-cpr-ggmap-1.png" alt="2D plot via ggmap" width="672"><p class="caption">
2D plot via ggmap
</p>
</div>
<p>We can also see the vertical profiles vs distance (for the ADS-B trajectory):</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="../reference/plot_flight_vertical_distance.html">plot_flight_vertical_distance</a></span>(trj_adsb <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/cumulative_distance.html">cumulative_distance</a></span>())</a></code></pre></div>
<div class="figure">
<img src="trrrj-plotting_files/figure-html/vert-distance-1.png" alt="Flight's vertical profile vs. distance" width="672"><p class="caption">
Flight’s vertical profile vs. distance
</p>
</div>
<p>or time:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="../reference/plot_flight_vertical_time.html">plot_flight_vertical_time</a></span>(trj_adsb <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/cumulative_time.html">cumulative_time</a></span>())</a></code></pre></div>
<div class="figure">
<img src="trrrj-plotting_files/figure-html/vert-time-1.png" alt="Flight's vertical profile vs. time" width="672"><p class="caption">
Flight’s vertical profile vs. time
</p>
</div>
<p>Now let’s plot all CPR trajectories (with automatic bounding box):</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">cprs <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/plot_cpr_horizontal.html">plot_cpr_horizontal</a></span>()</a></code></pre></div>
<div class="figure">
<img src="trrrj-plotting_files/figure-html/all-cprs-2d-1.png" alt="A map of all sample CPR trajectories" width="672"><p class="caption">
A map of all sample CPR trajectories
</p>
</div>
<div id="base-map-europe" class="section level3">
<h3 class="hasAnchor">
<a href="#base-map-europe" class="anchor"></a>Base map: Europe</h3>
<p>The <code>pruatlas</code> package provides a base map for Europe using a Lambert Azimuthal Equal-Area projection. It could be a useful package to further extend for plotting trajectories. It is on PRU’s github account, <a href="https://github.com/euctrl-pru/pruatlas">euctrl-pru/pruatlas</a>.</p>
</div>
<div id="retrive-fr24-ads-b-data-from-db" class="section level3">
<h3 class="hasAnchor">
<a href="#retrive-fr24-ads-b-data-from-db" class="anchor"></a>Retrive FR24 ADS-B data from DB</h3>
<p>The <code>trrrj</code> package provides an API to retrieve FR24 data from the DB. The use case here is for flights around an airport.</p>
<p>Before continuing <strong>BE CAREFUL</strong> about how to use it, you could get a lot of data back and il could take a lot of time.</p>
<p>Let’s say you want to retrieve the <em>arrival</em> flow to <a href="https://en.wikipedia.org/wiki/Stavanger_Airport,_Sola">Stavanger airport</a> in Norway for the 6th Sep 2017, then you need to issue the following command (showing the first 10 ones only):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ROracle)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">svg20170906flt &lt;-<span class="st"> </span><span class="kw"><a href="../reference/export_flights_at_airport_fr24.html">export_flights_at_airport_fr24</a></span>(<span class="st">"2017-09-06T00:00:00Z"</span>,</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">                                                 <span class="st">"2017-09-07T00:00:00Z"</span>,</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">                                                 <span class="st">"SVG"</span>,</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">                                                 <span class="dt">flow =</span> <span class="st">"ARR"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># fake the ROracle call</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(<span class="dt">file =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(), <span class="st">"/data/flts.rda"</span>))</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">svg20170906flt &lt;-<span class="st">  </span>flts <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(real_to <span class="op">==</span><span class="st"> "BRU"</span>)</a>
<a class="sourceLine" id="cb7-7" data-line-number="7"></a>
<a class="sourceLine" id="cb7-8" data-line-number="8">knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(</a>
<a class="sourceLine" id="cb7-9" data-line-number="9">  <span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(svg20170906flt, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb7-10" data-line-number="10">  <span class="dt">caption =</span> <span class="st">"Arrival flights at Stavanger airport, Norway, on Sep 6, 2017 (10 only)"</span>)</a></code></pre></div>
<table class="table">
<caption>Arrival flights at Stavanger airport, Norway, on Sep 6, 2017 (10 only)</caption>
<thead><tr class="header">
<th align="right">flight_id</th>
<th align="left">aircraft_id</th>
<th align="left">reg</th>
<th align="left">equip</th>
<th align="left">callsign</th>
<th align="left">flight</th>
<th align="left">schd_from</th>
<th align="left">schd_to</th>
<th align="left">real_to</th>
<th align="left">date</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">207635488</td>
<td align="left">4509122</td>
<td align="left">OOSNB</td>
<td align="left">A320</td>
<td align="left">BEL3292</td>
<td align="left">SN3292</td>
<td align="left">TLV</td>
<td align="left">BRU</td>
<td align="left">BRU</td>
<td align="left">2017-02-05</td>
</tr></tbody>
</table>
<p>To get the position reports 40 NM around the airport for those flights (showing the first 10 ones):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(trrrj)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co"># </span><span class="al">TODO</span><span class="co">: handle the case when building w/ Oracle DB</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">svg20170906pos &lt;-<span class="st"> </span><span class="kw"><a href="../reference/export_flights_at_airport_fr24.html">export_flights_at_airport_fr24</a></span>(</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">  <span class="st">"2017-09-06"</span>, <span class="st">"2017-09-07"</span>,</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">  <span class="st">"SVG"</span>, <span class="fl">5.638</span>, <span class="fl">58.877</span>,</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">  <span class="dt">flow =</span> <span class="st">"ARR"</span>,</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">  <span class="dt">radius =</span> <span class="dv">40</span>)</a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co"># knitr::kable(head(svg20170906pos, 10))</span></a></code></pre></div>
<p>Then prepare the data and then plot:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">svg20170906pos &lt;-<span class="st"> </span>svg20170906pos <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">longitude =</span> LON, <span class="dt">latitude =</span> LAT) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">longitude =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(longitude), <span class="dt">latitude =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(latitude))</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">svg20170906flt &lt;-<span class="st"> </span>svg20170906flt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">callsign =</span> CALLSIGN)</a>
<a class="sourceLine" id="cb9-7" data-line-number="7"></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">svg20170906pos &lt;-<span class="st"> </span>svg20170906pos <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="st">  </span><span class="kw">left_join</span>(svg20170906flt)</a>
<a class="sourceLine" id="cb9-10" data-line-number="10"></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="kw"><a href="../reference/plot_flight_horizontal.html">plot_flight_horizontal</a></span>(svg20170906pos)</a></code></pre></div>
</div>
</div>
<div id="file-archived-trajectories" class="section level2">
<h2 class="hasAnchor">
<a href="#file-archived-trajectories" class="anchor"></a>(File) Archived Trajectories</h2>
<p>The <code>trrrj</code> package provides import facilities for FR24 archive files:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(trrrj)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"></a>
<a class="sourceLine" id="cb10-4" data-line-number="4">######## flights</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">flights_dir &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata"</span>, <span class="dt">package =</span> <span class="st">"trrrj"</span>)</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">flights_csvs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list.files">dir</a></span>(flights_dir, <span class="dt">pattern =</span> <span class="st">"201702.._flights</span><span class="ch">\\</span><span class="st">.csv"</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">flights &lt;-<span class="st"> </span><span class="kw"><a href="../reference/import_flights_csvs.html">import_flights_csvs</a></span>(flights_csvs)</a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt; Warning: 2 parsing failures.</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; row      col expected        actual                                                        file</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt;  23 callsign          embedded null '/home/travis/R/Library/trrrj/extdata/20170206_flights.csv'</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt;  24 callsign          embedded null '/home/travis/R/Library/trrrj/extdata/20170206_flights.csv'</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12">(pbs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/attr">attr</a></span>(flights, <span class="st">"problems"</span>))</a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt; # A tibble: 2 x 6</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt;     row col     expected actual    file                           flight_id</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;                              &lt;int&gt;</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt; 1    23 callsi… ""       embedded… '/home/travis/R/Library/trrrj… 207702847</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="co">#&gt; 2    24 callsi… ""       embedded… '/home/travis/R/Library/trrrj… 207702848</span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"><span class="co"># the problematic rows have truncated values after the embedded NUL,</span></a>
<a class="sourceLine" id="cb10-20" data-line-number="20"><span class="co"># so filter them out ...</span></a>
<a class="sourceLine" id="cb10-21" data-line-number="21">bad_rows &lt;-<span class="st"> </span>pbs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(flight_id)</a>
<a class="sourceLine" id="cb10-22" data-line-number="22">flights &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-23" data-line-number="23"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span>(flight_id <span class="op">%in%</span><span class="st"> </span>bad_rows)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-24" data-line-number="24"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>reserved)</a></code></pre></div>
<p>Here are the first 10 entries (some variables omitted):</p>
<table class="table">
<thead><tr class="header">
<th align="right">flight_id</th>
<th align="left">reg</th>
<th align="left">equip</th>
<th align="left">schd_from</th>
<th align="left">schd_to</th>
<th align="left">real_to</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">207610917</td>
<td align="left">OKYBA</td>
<td align="left">A333</td>
<td align="left">PRG</td>
<td align="left">ICN</td>
<td align="left">ICN</td>
</tr>
<tr class="even">
<td align="right">207541132</td>
<td align="left">EIEBP</td>
<td align="left">B738</td>
<td align="left">CHQ</td>
<td align="left">SKG</td>
<td align="left">SKG</td>
</tr>
<tr class="odd">
<td align="right">207587763</td>
<td align="left">GCIXW</td>
<td align="left">E170</td>
<td align="left">HAM</td>
<td align="left">LCY</td>
<td align="left">LCY</td>
</tr>
<tr class="even">
<td align="right">207507520</td>
<td align="left">VTANP</td>
<td align="left">B788</td>
<td align="left">AMD</td>
<td align="left">LHR</td>
<td align="left">LHR</td>
</tr>
<tr class="odd">
<td align="right">207635488</td>
<td align="left">OOSNB</td>
<td align="left">A320</td>
<td align="left">TLV</td>
<td align="left">BRU</td>
<td align="left">BRU</td>
</tr>
<tr class="even">
<td align="right">207586064</td>
<td align="left">DAIBI</td>
<td align="left">A319</td>
<td align="left">FRA</td>
<td align="left">BRE</td>
<td align="left">BRE</td>
</tr>
<tr class="odd">
<td align="right">207545993</td>
<td align="left">RA89023</td>
<td align="left">SU95</td>
<td align="left">SVO</td>
<td align="left">KUF</td>
<td align="left">KUF</td>
</tr>
<tr class="even">
<td align="right">207600764</td>
<td align="left">GRJXD</td>
<td align="left">E145</td>
<td align="left">FRA</td>
<td align="left">JKG</td>
<td align="left">JKG</td>
</tr>
<tr class="odd">
<td align="right">207535493</td>
<td align="left">TCAMP</td>
<td align="left">B738</td>
<td align="left">SZF</td>
<td align="left">SAW</td>
<td align="left">SAW</td>
</tr>
<tr class="even">
<td align="right">207513109</td>
<td align="left">TCJJF</td>
<td align="left">B77W</td>
<td align="left">LAX</td>
<td align="left">IST</td>
<td align="left">IST</td>
</tr>
</tbody>
</table>
<p>A sample of FR24 flight data is available as <code>flts</code> dataset in the package. See also the relevant help page, <code><a href="../reference/flts.html">?flts</a></code>.</p>
<div id="file-archived-positions" class="section level3">
<h3 class="hasAnchor">
<a href="#file-archived-positions" class="anchor"></a>(File) Archived Positions</h3>
<div id="ads-b-positions" class="section level4">
<h4 class="hasAnchor">
<a href="#ads-b-positions" class="anchor"></a>ADS-B Positions</h4>
<p>The <code>trrrj</code> package provides helpes to read position report files from FR24 archive data feed. In order to read the ADS-B position reports for the days from the previous section:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">######## positions</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">poss_dirs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"20170206_positions"</span>, <span class="st">"20170205_positions"</span>)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">poss_dirs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata"</span>, poss_dirs, <span class="dt">package =</span> <span class="st">"trrrj"</span>)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">poss_csvs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list.files">dir</a></span>(poss_dirs, <span class="dt">pattern =</span> <span class="st">"201702.._.*</span><span class="ch">\\</span><span class="st">.csv"</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">positions &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span>(poss_csvs, read_positions_fr24)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co"># augment with flight info</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8">positions &lt;-<span class="st"> </span>positions <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(flights, <span class="dt">by =</span> <span class="st">"flight_id"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(callsign), callsign <span class="op">!=</span><span class="st"> "YELLOW6"</span>)</a></code></pre></div>
<p>The first 10 entries (some variables omitted) for flight “AIC175” (<code>flight_id</code> = <code>207507520</code>) are:</p>
<table class="table">
<thead><tr class="header">
<th align="right">flight_id</th>
<th align="left">timestamp</th>
<th align="right">altitude</th>
<th align="right">heading</th>
<th align="right">latitude</th>
<th align="right">longitude</th>
<th align="right">speed</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">207507520</td>
<td align="left">2017-02-05 04:56:15</td>
<td align="right">38000</td>
<td align="right">291</td>
<td align="right">36.18664</td>
<td align="right">52.95428</td>
<td align="right">425</td>
</tr>
<tr class="even">
<td align="right">207507520</td>
<td align="left">2017-02-05 04:57:17</td>
<td align="right">38000</td>
<td align="right">291</td>
<td align="right">36.23184</td>
<td align="right">52.81566</td>
<td align="right">424</td>
</tr>
<tr class="odd">
<td align="right">207507520</td>
<td align="left">2017-02-05 04:58:18</td>
<td align="right">38000</td>
<td align="right">291</td>
<td align="right">36.27630</td>
<td align="right">52.67845</td>
<td align="right">424</td>
</tr>
<tr class="even">
<td align="right">207507520</td>
<td align="left">2017-02-05 04:59:20</td>
<td align="right">38000</td>
<td align="right">291</td>
<td align="right">36.32181</td>
<td align="right">52.53754</td>
<td align="right">424</td>
</tr>
<tr class="odd">
<td align="right">207507520</td>
<td align="left">2017-02-05 05:00:21</td>
<td align="right">37975</td>
<td align="right">291</td>
<td align="right">36.36580</td>
<td align="right">52.40049</td>
<td align="right">422</td>
</tr>
<tr class="even">
<td align="right">207507520</td>
<td align="left">2017-02-05 05:01:22</td>
<td align="right">38000</td>
<td align="right">291</td>
<td align="right">36.40934</td>
<td align="right">52.26424</td>
<td align="right">423</td>
</tr>
<tr class="odd">
<td align="right">207507520</td>
<td align="left">2017-02-05 05:02:26</td>
<td align="right">38000</td>
<td align="right">291</td>
<td align="right">36.45547</td>
<td align="right">52.11931</td>
<td align="right">423</td>
</tr>
<tr class="even">
<td align="right">207507520</td>
<td align="left">2017-02-05 05:03:28</td>
<td align="right">38000</td>
<td align="right">291</td>
<td align="right">36.49900</td>
<td align="right">51.98169</td>
<td align="right">424</td>
</tr>
<tr class="odd">
<td align="right">207507520</td>
<td align="left">2017-02-05 05:04:30</td>
<td align="right">38000</td>
<td align="right">291</td>
<td align="right">36.54406</td>
<td align="right">51.83893</td>
<td align="right">423</td>
</tr>
<tr class="even">
<td align="right">207507520</td>
<td align="left">2017-02-05 05:05:33</td>
<td align="right">38000</td>
<td align="right">291</td>
<td align="right">36.58923</td>
<td align="right">51.69468</td>
<td align="right">425</td>
</tr>
</tbody>
</table>
<p>A sample of FR24 ADS-B position report data is available as <code>poss</code> dataset in the package. See also the relevant help page, <code><a href="../reference/poss.html">?poss</a></code>.</p>
</div>
<div id="file-archived-correlated-position-reports-cprs" class="section level4">
<h4 class="hasAnchor">
<a href="#file-archived-correlated-position-reports-cprs" class="anchor"></a>(File) Archived Correlated Position Reports (CPR’s)</h4>
<p>The <code>trrrj</code> package provides facilities to read NM’s archived CPR files. In order to import all cprs for the 2 demo days:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># read all 5th and 6th February 2017 CPR's files</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="co"># cprs_dirs &lt;- system.file("extdata", package = "trrrj")</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co"># cprs_delims &lt;- dir(</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co">#    cprs_dirs,</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">#    pattern = "1.2017020.1001tacop304ARCHIVED_OPLOG_ALL_CPR\\.gz",</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#    full.names = TRUE)</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7">cprs_delims &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">  <span class="kw"><a href="../reference/trrrj_example.html">trrrj_example</a></span>(<span class="st">"1.201702051001tacop304ARCHIVED_OPLOG_ALL_CPR.gz"</span>),</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">  <span class="kw"><a href="../reference/trrrj_example.html">trrrj_example</a></span>(<span class="st">"1.201702061001tacop304ARCHIVED_OPLOG_ALL_CPR.gz"</span>))</a>
<a class="sourceLine" id="cb12-10" data-line-number="10"></a>
<a class="sourceLine" id="cb12-11" data-line-number="11">poss_cpr &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span>(cprs_delims, read_cpr)</a></code></pre></div>
<p>and then show the first 10 entries (some variables omitted) for the same flight, “AIC175”, as for the ADS-B positions:</p>
<table class="table">
<thead><tr class="header">
<th align="right">tact_id</th>
<th align="left">timestamp_track</th>
<th align="left">callsign</th>
<th align="right">flight_level</th>
<th align="right">track_heading</th>
<th align="right">latitude</th>
<th align="right">longitude</th>
<th align="right">track_speed</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">847918</td>
<td align="left">2017-02-05 07:25:16</td>
<td align="left">AIC175</td>
<td align="right">400</td>
<td align="right">304.7772</td>
<td align="right">42.63778</td>
<td align="right">30.22139</td>
<td align="right">461</td>
</tr>
<tr class="even">
<td align="right">847918</td>
<td align="left">2017-02-05 07:25:25</td>
<td align="left">AIC175</td>
<td align="right">400</td>
<td align="right">311.4294</td>
<td align="right">42.65250</td>
<td align="right">30.20500</td>
<td align="right">480</td>
</tr>
<tr class="odd">
<td align="right">847918</td>
<td align="left">2017-02-05 07:25:50</td>
<td align="left">AIC175</td>
<td align="right">400</td>
<td align="right">312.6158</td>
<td align="right">42.68667</td>
<td align="right">30.14944</td>
<td align="right">462</td>
</tr>
<tr class="even">
<td align="right">847918</td>
<td align="left">2017-02-05 07:25:54</td>
<td align="left">AIC175</td>
<td align="right">400</td>
<td align="right">309.5233</td>
<td align="right">42.69167</td>
<td align="right">30.14389</td>
<td align="right">457</td>
</tr>
<tr class="odd">
<td align="right">847918</td>
<td align="left">2017-02-05 07:26:19</td>
<td align="left">AIC175</td>
<td align="right">400</td>
<td align="right">311.1658</td>
<td align="right">42.72667</td>
<td align="right">30.08583</td>
<td align="right">462</td>
</tr>
<tr class="even">
<td align="right">847918</td>
<td align="left">2017-02-05 07:26:28</td>
<td align="left">AIC175</td>
<td align="right">400</td>
<td align="right">307.4578</td>
<td align="right">42.73833</td>
<td align="right">30.06889</td>
<td align="right">463</td>
</tr>
<tr class="odd">
<td align="right">847918</td>
<td align="left">2017-02-05 07:26:48</td>
<td align="left">AIC175</td>
<td align="right">400</td>
<td align="right">311.4350</td>
<td align="right">42.76778</td>
<td align="right">30.02306</td>
<td align="right">464</td>
</tr>
<tr class="even">
<td align="right">847918</td>
<td align="left">2017-02-05 07:26:57</td>
<td align="left">AIC175</td>
<td align="right">400</td>
<td align="right">308.3697</td>
<td align="right">42.78000</td>
<td align="right">30.00639</td>
<td align="right">464</td>
</tr>
<tr class="odd">
<td align="right">847918</td>
<td align="left">2017-02-05 07:27:21</td>
<td align="left">AIC175</td>
<td align="right">400</td>
<td align="right">311.6161</td>
<td align="right">42.81611</td>
<td align="right">29.94917</td>
<td align="right">466</td>
</tr>
<tr class="even">
<td align="right">847918</td>
<td align="left">2017-02-05 07:27:30</td>
<td align="left">AIC175</td>
<td align="right">400</td>
<td align="right">308.6775</td>
<td align="right">42.82833</td>
<td align="right">29.93306</td>
<td align="right">465</td>
</tr>
</tbody>
</table>
<p>A sample of NM’s CPR’s data is available as <code>cprs</code> dataset in the package. See also the relevant help page, <code><a href="../reference/cprs.html">?cprs</a></code>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#plotting">Plotting</a></li>
      <li><a href="#file-archived-trajectories">(File) Archived Trajectories</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://enrico.spinielli.net">Enrico Spinielli</a>, <a href="https://www.eurocontrol.int"><img src="https://ansperformance.eu/nvctr/reference/figures/euctrl-logo-wide.svg" height="24"></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
